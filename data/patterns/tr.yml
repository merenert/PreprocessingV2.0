# Turkish Address Pattern Definitions
# DSL for extracting address components from preprocessed text
#
# Pattern Syntax:
#   <SlotName>     - Required named slot (e.g., <Mahalle>, <Sokak>)
#   <SlotName?>    - Optional named slot
#   <n>           - Number slot (numeric value)
#   <text>        - Generic text slot
#   literal       - Literal text that must match exactly
#
# Priority: Higher numbers = higher priority (checked first)

patterns:
  # Simple patterns (high confidence when matched)
  - id: "mahalle_sokak_no"
    priority: 90
    pattern: "<Mahalle> <Sokak> no <n>"
    description: "Mahalle + Sokak + No format"
    examples:
      - "moda mahalle bahariye sokak no 12"
      - "konak mahalle cumhuriyet sokak no 45"

  - id: "mahalle_cadde_no"
    priority: 89
    pattern: "<Mahalle> <Cadde> no <n>"
    description: "Mahalle + Cadde + No format"
    examples:
      - "balgat mahalle turan güneş cadde no 67"
      - "alsancak mahalle cumhuriyet cadde no 123"

  # Patterns with building details
  - id: "full_address_with_building"
    priority: 85
    pattern: "<Mahalle> <Sokak> no <n> daire <Daire>"
    description: "Complete address with apartment"
    examples:
      - "moda mahalle bahariye sokak no 12 daire 5"
      - "konak mahalle atatürk sokak no 34 daire 8"

  # Patterns with optional explanation
  - id: "explanation_mahalle_sokak_no"
    priority: 80
    pattern: "<Açıklama?> <Mahalle> <Sokak> no <n>"
    description: "Optional explanation + Mahalle + Sokak + No"
    examples:
      - "istanbul kadiköy moda mahalle bahariye sokak no 12"
      - "izmir konak alsancak mahalle atatürk sokak no 45"
      - "moda mahalle bahariye sokak no 12"  # without explanation

  # Complex patterns with multiple components
  - id: "complex_address_full"
    priority: 75
    pattern: "<Açıklama?> <Mahalle> <Sokak> no <n> kat <Kat> daire <Daire>"
    description: "Complex address with floor and apartment"
    examples:
      - "istanbul kadiköy moda mahalle prof daire cadde numara12 kat 5 daire 15"
      - "moda mahalle bahariye sokak no 12 kat 3 daire 7"

  # Block/Apartment complex patterns
  - id: "site_pattern"
    priority: 70
    pattern: "<Site> <Blok?> no <n> daire <Daire>"
    description: "Apartment complex with optional block"
    examples:
      - "rivella evleri a blok no 77 daire 15"
      - "ismail soyak sitesi ablok no 6 daire 5"
      - "burak yar sitesi no 12 daire 3"

  # Street-focused patterns
  - id: "sokak_numara_simple"
    priority: 65
    pattern: "<Sokak> numara <n>"
    description: "Simple street + number"
    examples:
      - "bahariye sokak numara 12"
      - "atatürk cadde numara 45"

  # Number-first patterns
  - id: "numara_first_pattern"
    priority: 60
    pattern: "<n> sokak no <n2>"
    description: "Street number + building number"
    examples:
      - "1771 sokak no 5"
      - "4632 sokak no 16"

  # Real-world patterns from CSV data
  - id: "mahalle_sokak_no_colon"
    priority: 88
    pattern: "<Mahalle> <n> sokak no <n2>"
    description: "Mahalle + numbered street + no"
    examples:
      - "ergene mahalle 534 sokak no 1"
      - "kalabak mah 3328 sokak no 8"

  - id: "mahalle_sokak_no_slash"
    priority: 87
    pattern: "<Mahalle> <Sokak> no <n>/<text>"
    description: "Address with apartment indicator (/A, /b)"
    examples:
      - "ergene mahalle 534 sokak no 1/b"
      - "yeni mah 618 sok no 5/A"

  - id: "mahalle_site_sokak_no"
    priority: 86
    pattern: "<Mahalle> <Site> <Sokak> no <n>"
    description: "Mahalle + site/complex + sokak + no"
    examples:
      - "karaova mahalle idareciler sitesi lale sokak no 27"
      - "mordogan mahalle doga evleri 12 sokak no 28"

  - id: "mahalle_sk_abbreviation"
    priority: 84
    pattern: "<Mahalle> <n> sk no <n2>"
    description: "Mahalle with sokak abbreviated as 'sk'"
    examples:
      - "zafer mah 114 sk no 1"
      - "başka mah 522 sk no 49"

  - id: "mahalle_full_apartment"
    priority: 83
    pattern: "<Mahalle> <Sokak> no <n> kat <Kat> daire <Daire> <text?>"
    description: "Complete apartment address with building name"
    examples:
      - "zafer mah 114 sk no 1 kat 3 daire 32 başar suites apartmanı"
      - "çırkan mahalle başaran sokak no 11 kat 2 daire 5"

  - id: "comma_separated_address"
    priority: 82
    pattern: "<Mahalle>, <text>, <n> sokak, no <n2>"
    description: "Comma-separated address format"
    examples:
      - "mordogan mahalle, doga evleri, 12 sokak, no 28"
      - "kalabak mah, site adi, 3328 sokak, no 8"

  - id: "city_district_pattern"
    priority: 81
    pattern: "<Mahalle> <Sokak> no <n> <İlçe>/<İl>"
    description: "Address with district/city suffix"
    examples:
      - "konacık çırkan mahalle başaran sokak no 11 bodrum/muğla"
      - "zafer mah sokak no 1 efeler/aydın"

  - id: "informal_business_address"
    priority: 79
    pattern: "<text> <Mahalle> <n> sok no <n2>"
    description: "Business name + address format"
    examples:
      - "bosch siemens profilo yetkili servisi yeni mah 618 sok no 5"
      - "akın sigorta ergene mahalle 534 sok no 1"

  - id: "apartment_building_name"
    priority: 78
    pattern: "<Sokak> <text> no <n> daire <Daire> kat <Kat>"
    description: "Street + building name + details"
    examples:
      - "ekrem karabaş sokak aysima apy no 20 daire 2 kat 1"
      - "başaran sokak residence no 11 daire 5 kat 3"

  - id: "numbered_street_simple"
    priority: 77
    pattern: "<n>/<n2> sokak no <n3>"
    description: "Numbered street format"
    examples:
      - "522/56 sokak no 49"
      - "1234/78 sokak no 12"

  - id: "site_block_apartment"
    priority: 76
    pattern: "<Mahalle> <Site> <Blok?> no <n> daire <Daire>"
    description: "Site with optional block and apartment"
    examples:
      - "konacık mahalle başaran sitesi a blok no 11 daire 2"
      - "karaova mahalle idareciler sitesi no 27 daire 5"

  # Loose patterns (lower confidence)
  - id: "loose_mahalle_only"
    priority: 50
    pattern: "<Mahalle> <text?>"
    description: "Mahalle with optional additional text"
    examples:
      - "moda mahalle"
      - "konak mahalle 123"

  # Keywords for pattern matching enhancement
keywords:
  location_indicators:
    - "mahalle"
    - "mah"
    - "sitesi"
    - "evleri"
    - "apartmanı"
    - "apy"
    - "residence"
    - "complex"

  street_indicators:
    - "sokak"
    - "sok"
    - "sk"
    - "cadde"
    - "cad"
    - "cd"
    - "bulvar"
    - "blv"
    - "blvr"

  building_indicators:
    - "no"
    - "numara"
    - "num"
    - ":"

  apartment_indicators:
    - "daire"
    - "dair"
    - "dr"
    - "kat"
    - "floor"
    - "blok"
    - "block"

  city_indicators:
    - "istanbul"
    - "ankara"
    - "izmir"
    - "bursa"
    - "antalya"
    - "adana"
    - "konya"
    - "gaziantep"
    - "mersin"
    - "kayseri"
    - "eskişehir"
    - "diyarbakır"
    - "samsun"
    - "denizli"
    - "şanlıurfa"
    - "adapazarı"
    - "malatya"
    - "kahramanmaraş"
    - "erzurum"
    - "van"
    - "batman"
    - "elazığ"
    - "iğdır"
    - "tokat"
    - "trabzon"
    - "kocaeli"
    - "manisa"
    - "rize"
    - "aydın"
    - "tekirdağ"
    - "balıkesir"
    - "kütahya"
    - "muğla"
    - "afyon"
    - "uşak"
    - "çanakkale"
    - "bodrum"
    - "kuşadası"
    - "karaburun"
    - "urla"
    - "efeler"

# Scoring configuration
scoring:
  # Base confidence scores for different slot types
  slot_weights:
    Mahalle: 0.25      # District/neighborhood
    Sokak: 0.20        # Street
    Cadde: 0.20        # Avenue
    n: 0.15            # Building number
    Daire: 0.10        # Apartment number
    Kat: 0.05          # Floor
    Site: 0.15         # Complex/site
    Blok: 0.05         # Block
    İl: 0.10           # Province
    İlçe: 0.10         # District
    text: 0.05         # Generic text

  # Minimum confidence threshold for accepting matches
  min_confidence_threshold: 0.3

  # Threshold for considering a match "good"
  good_match_threshold: 0.6

  # Penalty for missing required slots
  missing_slot_penalty: 0.2

  # Bonus for exact keyword matches
  keyword_match_bonus: 0.1
    - "sokak"
    - "sok"
    - "cadde"
    - "cad"
    - "numara"
    - "no"
    - "daire"
    - "kat"
    - "blok"
    - "sitesi"

  low_importance:
    - "istanbul"
    - "ankara"
    - "izmir"
    - "bursa"
    - "antalya"

# Scoring weights for confidence calculation
scoring:
  # Base weights for different match types
  exact_match_weight: 1.0
  token_overlap_weight: 0.8
  keyword_presence_weight: 0.6
  pattern_coverage_weight: 0.9

  # Slot-specific weights
  slot_weights:
    Mahalle: 0.9
    Sokak: 0.9
    Cadde: 0.9
    n: 0.8        # numeric values
    Daire: 0.7
    Kat: 0.7
    Site: 0.8
    Blok: 0.6
    Açıklama: 0.25  # Low weight for explanation
    text: 0.3       # Generic text has low weight

  # Penalty factors
  missing_required_slot_penalty: 0.3
  extra_text_penalty: 0.1

  # Thresholds
  min_confidence_threshold: 0.3
  good_match_threshold: 0.7
